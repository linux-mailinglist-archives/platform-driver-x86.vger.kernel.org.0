Return-Path: <platform-driver-x86-owner@vger.kernel.org>
X-Original-To: lists+platform-driver-x86@lfdr.de
Delivered-To: lists+platform-driver-x86@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 0ADF32A45EC
	for <lists+platform-driver-x86@lfdr.de>; Tue,  3 Nov 2020 14:07:42 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729089AbgKCNHl (ORCPT
        <rfc822;lists+platform-driver-x86@lfdr.de>);
        Tue, 3 Nov 2020 08:07:41 -0500
Received: from mail-02.mail-europe.com ([51.89.119.103]:43014 "EHLO
        mail-02.mail-europe.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1729175AbgKCNHG (ORCPT
        <rfc822;platform-driver-x86@vger.kernel.org>);
        Tue, 3 Nov 2020 08:07:06 -0500
Date:   Tue, 03 Nov 2020 13:06:56 +0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=protonmail.com;
        s=protonmail; t=1604408822;
        bh=ctd24bJNHq1OvsbJTD38eYc2pQ2/JmNGN5uoXG288Vo=;
        h=Date:To:From:Reply-To:Subject:In-Reply-To:References:From;
        b=alzITg8WhFUsueDSv4rW7to7ekxuNuC2Yr8/zWE8kmO+4RuRQ2FlLycZmn3CNoCgi
         TLAh2FS3661kaQnd2aiw61iMh6G7hO5qaRj4j4BKseq1ew9uFqX+ymySPbE4mwKwUe
         IF7sy8nw6Tw1rxHZF/XaF2IUPun0C/x8IWePmmio=
To:     Rhys Perry <rhysperry111@gmail.com>,
        Platform Driver <platform-driver-x86@vger.kernel.org>
From:   =?utf-8?Q?Barnab=C3=A1s_P=C5=91cze?= <pobrn@protonmail.com>
Reply-To: =?utf-8?Q?Barnab=C3=A1s_P=C5=91cze?= <pobrn@protonmail.com>
Subject: Re: [hp_wmi] Recieving same keycode from two keys
Message-ID: <A3oiTx-vaeJfCMZHt3dL_jvvIWiEDWGcOZxpZCVSzWYHr94r7jmHVKP01ApdKc1mZdcKsmwrr0O4e_L5MBSgU_LcsyOpGLx9xbZjX1q900Y=@protonmail.com>
In-Reply-To: <CAGTBY+tso9BKJwe5F5bBU_RAo0yrwtYf=kGm1UvMpTJurS00MQ@mail.gmail.com>
References: <Q5ZWCQ.DX8TK304ORAI@gmail.com> <CAGTBY+sgwYrDPtQgJV=TcXJ73n8TGf9Nw=arCfWMUrVFzAsEVQ@mail.gmail.com> <HTSPI6-Ba3MfCgVG7q_YbRF6mUqskmyRdtSb_7eE2G7oCi_rSo5UP1ZKRK-qVfzSZ1zm_5sNp5hUorvgRz3VF8RM8b8361CLzbq4X5z59hw=@protonmail.com> <CAGTBY+vQ+UMPqFCwKMS0L5=F3eqQ21UtGETgmE+Le=SXcaWS2w@mail.gmail.com> <bjucdDbwHvavLvYVkhboo_jhvKC6ccqAslFPuuYO0ZZcgTZZaICda3WMFZhw_zS1o1m7VanyCmaJ4HZMqgyXwsCfqJFDGxb_1A4pdNCe8Bw=@protonmail.com> <CAGTBY+tso9BKJwe5F5bBU_RAo0yrwtYf=kGm1UvMpTJurS00MQ@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
X-Spam-Status: No, score=-1.2 required=10.0 tests=ALL_TRUSTED,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,FREEMAIL_FROM shortcircuit=no
        autolearn=disabled version=3.4.4
X-Spam-Checker-Version: SpamAssassin 3.4.4 (2020-01-24) on
        mailout.protonmail.ch
Precedence: bulk
List-ID: <platform-driver-x86.vger.kernel.org>
X-Mailing-List: platform-driver-x86@vger.kernel.org

(please use reply-all so that the mailing list gets the emails as well)


> > [...]
> > > > Can you see any messages generated by the hp-wmi driver when these =
key presses occur?
> > >
> > > Not that I know of, unless there is some sort of debug mode that can =
be enabled
> > >
> > > > > > Now, this is not that interesting at first, I obviously just ne=
ed to
> > > > > > map a keycode. The confusing part is that for both the brightne=
ss up
> > > > > > AND the brightness down key I get the same code (e02b). I am no=
t to
> > > > > > sure how to debug this behavior but I would appreciate if someo=
ne
> > > > > > helped investigate this issue.
> > > > > > I am not sure if this is relevant, but my RFKILL key does not w=
ork
> > > > > > either (but does not show anything in journal).
> > > >
> > > > Could you please run `evtest` and see if you have a "HP WMI hotkeys=
" input device?
> > > > If so, please select it, and then press the function keys and see i=
f any events appear.
> > >
> > > After running`evtest` there is a device called "HP WMI hotkeys" (on
> > > /dev/input/event16). However, after selecting it and pressing the
> > > brightness keys no events appear.
> > >
> > > > Furthermore, you could install `acpid`, start it (something along t=
he lines of
> > > > `sudo systemctl start acpid`), then run `acpi_listen` and see if yo=
u get anything
> > > > when you press the keys.
> > >
> > > After starting the service and running`acpi_listen`, no events appear
> > > when pressing the brightness keys
> > >
> > > > > > Here is a link to acpidump:
> > > > > > https://www.dropbox.com/s/ulyltq0gz35s79l/acpidump?dl=3D0
> > > > > > ::: Rhys Perry :::
> > > [...]
> >
> > Could you test other function keys like volume up/down, etc.?
> >
> After running some tests with evtest I have found out:
> - Brightness keys: "AT Translated Set 2 keyboard" (although same keycode)
> - Volume keys: "AT Translated Set 2 keyboard"
> - Media keys: "AT Translated Set 2 keyboard"
> - RFKILL key: (none, although there is a device called "HP Wireless hotke=
ys")

Please install the `evemu` program suite, and run `evemu-record /dev/input/=
event...`
for the AT keyboard, HP WMI hotkeys, and HP Wireless hotkeys; in each run p=
ress the
brightness up/down, volume up/down keys in any fixed order you like, and th=
en send
the output of each run (including the part that is initially printed before
receiving any events). Could you also run `acpi_listen` at the same time an=
d
see if any key presses are registered there? If yes, what was the output?

Just to summarize (please correct me if I'm wrong):
- brightness up/down keys
  * send the same scan code via the keyboard; and
  * do not trigger any ACPI events
- volume up/down, and media keys send unique key codes via the keyboard and=
 they work (?)
- the rfkill hotkey does not appear to generate any events whatsoever (?)
- the "HP WMI hotkeys" and "HP Wireless hotkeys" input devices don't regist=
er
  any events

By the way, I suppose that screen brightness control with hotkeys does not =
work,
correct?


> I wonder what the point of the HP WMI or Wireless devices are if they
> are not receiving any events.

I can only assume that they do work in some circumstances/with older models=
/etc.


> In the past I have done some
> experimenting with the ACPI_OSI kernel parameter and IIRC I did not
> get anything to change. This poses the question, how does Windows know
> the difference between brightness up/down?
> [...]


Regards,
Barnab=C3=A1s P=C5=91cze
